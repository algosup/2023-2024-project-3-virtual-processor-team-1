#include <stdio.h>
#include <stdlib.h>
#include "vcpu.h"

int main() {




	i64 simpleAdd[] = {
		0b000100000000000101011001000000100000000000000000, // MOV R3, 601
        0b001100010000000100000000001000000000000000000000,
        0B100000000000000100000000000000000000000000000000, // DISP R3
        0B000000000000000000000000000000000000000000000000, // NOP
	};


    i64 simpleFunction[] = {
        0B011100100000000100010000000000000000000000000000,// XOR R1, R1
        0B000100000000000111010100000000000000000000000000,// MOV R1, #77
        0B000100000000001101100100000000000000000000000000,// MOV R3, #70
        0B010100000000000100000011000000000000000000000000,// CMP R1, R3
        0B100000000000000100000000000000000000000000000000, // DISP R3
        0B100000000000001100000000000000000000000000000000, // DISP R3
        0B011000100000000010101011000100000000000000000000,// JNE .loop
        0B100000000000001100000000000000000000000000000000, // DISP R3
        0B000000000000000000000000000000000000000000000000, // NOP
        0B100110010000000010101011000100000000000000000000,// .loop
        0B001000100000001100000001000000000000000000000000,//  ADD R3, 1
        0B010100000000000100000011000000000000000000000000,// CMP R1, R3
        0B011001010000000010101011000100000000000000000000// JL .loop 
    };

    i64 arrayProgramLenght = sizeof(simpleFunction) / sizeof(simpleFunction[0]);
	// create new cpu with the given i64 array for memory
	// vcpu *c = new_vcpu(simpleAdd, 4);
    // vcpu *c3 = new_vcpu(simpleMul, 4);
    // vcpu *c4 = new_vcpu(simpleDiv, 4);
    vcpu *c5 = new_vcpu(simpleFunction, arrayProgramLenght);


	// run_vcpu(c);
    // free_vcpu(c);
    // run_vcpu(c3);
    // free_vcpu(c3);
    // run_vcpu(c4);
    // free_vcpu(c4);
     run_vcpu(c5);
     free_vcpu(c5);


    return 0;
}
